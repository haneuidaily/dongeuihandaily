<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<title>æ°£è±¡</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    .section { margin-bottom: 20px; }
    label { display: block; font-weight: bold; margin-bottom: 6px; }
    input, select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    input[type="range"] { height: 10px; }
    .range-wrapper { position: relative; }
    .range-labels-absolute {
      position: absolute;
      top: 30px;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      font-size: 0.85em;
    }
    .range-labels-absolute span {
      transform: translateX(-50%);
      width: 20px;
      text-align: center;
    }
    .btn {
      padding: 15px 30px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      display: block;
      margin: 30px auto;
    }
    .output {
      margin-top: 20px;
      padding: 12px;
      background: #f2f2f2;
      border-radius: 8px;
    }
    #mainPage, #reportPage { display: none; }
  </style>
</head>
<body>
<div style="text-align: center; margin-bottom: 30px;">
<h1 style="font-size: 2.5em; margin: 0;">æ°£è±¡</h1>
<div style="font-size: 1.1em; color: #555;">í•œì˜ ë°ì¼ë¦¬ ë¦¬í¬íŠ¸</div>
</div>
<div id="introPage">
<h2>ğŸ‘¤ ê¸°ë³¸ ì •ë³´ ì…ë ¥</h2>
<div class="section"><label>ì´ë¦„<input id="name" type="text"/></label></div>
<div class="section"><label>ë‚˜ì´<input id="age" type="number"/></label></div>
<div class="section"><label>ì„±ë³„<select id="gender"><option>ë‚¨</option><option>ì—¬</option></select></label></div>
<div class="section"><label>í‚¤ (cm)<input id="height" type="number"/></label></div>
<div class="section"><label>ëª¸ë¬´ê²Œ (kg)<input id="weight" type="number"/></label></div>
<button class="btn" onclick="goToMainPage()">ì…ë ¥ ì™„ë£Œ</button>
</div>
<div id="mainPage">
<h2>ğŸ“‹ ê±´ê°• ì •ë³´ ì…ë ¥</h2>
<form id="healthForm">
<div class="section"><label>ëŒ€ë³€ ë¹ˆë„</label>
<div class="range-wrapper"><input max="3" min="0" name="bowel_freq" type="range" value="1"/>
<div class="range-labels-absolute"><span>0</span><span>1</span><span>2</span><span>3</span></div></div></div>
<div class="section"><label>ëŒ€ë³€ ì‹œì›í•¨</label>
<div class="range-wrapper"><input max="5" min="1" name="bowel_satisfaction" type="range" value="3"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>
<div class="section"><label>ì†Œë³€ ë¹ˆë„</label>
<div class="range-wrapper"><input max="10" min="1" name="urine_freq" type="range" value="5"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span></div></div></div>
<div class="section"><label>ìˆ˜ë©´ ì‹œê°„</label>
<div class="range-wrapper"><input max="12" min="0" name="sleep_time" type="range" value="6"/>
<div class="range-labels-absolute"><span>0</span><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span><span>11</span><span>12</span></div></div></div>
<div class="section"><label>ìˆ˜ë©´ì˜ ì§ˆ (1: ë§¤ìš° ë‚˜ì¨ ~ 5: ë§¤ìš° ì¢‹ìŒ)</label>
<div class="range-wrapper"><input max="5" min="1" name="sleep_quality" type="range" value="3"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>
<div class="section"><label>ì‹ì‚¬ëŸ‰ (1: ì ìŒ ~ 5: ë§ìŒ)</label>
<div class="range-wrapper"><input max="5" min="1" name="meal_amount" type="range" value="3"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>
<div class="section"><label>ì‹í›„ ë¶ˆí¸ê° (1: ì „í˜€ ì—†ìŒ ~ 5: ë§¤ìš° ì‹¬í•¨)</label>
<div class="range-wrapper"><input max="5" min="1" name="digest_discomfort" type="range" value="2"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>
<div class="section"><label>ê°ì • ìƒíƒœ (1: ìš°ìš¸/ë¶ˆì•ˆ ~ 5: ì•ˆì •/ê¸ì •)</label>
<div class="range-wrapper"><input max="5" min="1" name="emotion" type="range" value="3"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>

<div class="section"><label>ëª¸ì˜ ìœ„ì¹˜ì  ì¦ìƒ (è¡¨è£)</label>
  <select name="pyo_li">
    <option value="0">ê²‰(í”¼ë¶€, ì™¸ë¶€)ì´ ë” ë¯¼ê°í•˜ë‹¤</option>
    <option value="1">ì†(ë³µë¶€, ë‚´ì¥)ì´ ë” ë¶ˆí¸í•˜ë‹¤</option>
  </select>
</div>

<div class="section"><label>ëª¸ì˜ ì²´ê° ì˜¨ë„ (å¯’ç†±)</label>
  <select name="han_yeol">
    <option value="0">ì¶”ìœ„ë¥¼ ë§ì´ íƒ„ë‹¤</option>
    <option value="1">ì—´ì´ ë§ê³  ë”ìœ„ë¥¼ ë§ì´ íƒ„ë‹¤</option>
  </select>
</div>

<div class="section"><label>í”¼ë¡œì™€ ê¸´ì¥ì˜ ì •ë„ (è™›å¯¦)</label>
  <select name="heo_sil">
    <option value="0">ë¬´ê¸°ë ¥í•˜ê³  ê¸°ìš´ì´ ì—†ë‹¤</option>
    <option value="1">ëª¸ì— ê¸´ì¥ê°ì´ ìˆê³  ì–µëˆŒë¦¬ëŠ” ëŠë‚Œ</option>
  </select>
</div>

<div class="section"><label>ì „ì²´ì ì¸ ê²½í–¥ (é™°é™½)</label>
  <select name="eum_yang">
    <option value="0">ì°¨ë¶„í•˜ê³  ë‚´í–¥ì ì¸ í¸</option>
    <option value="1">í™œë™ì ì´ê³  ì™¸í–¥ì ì¸ í¸</option>
  </select>
</div>

<div class="section"><label>í‰ì†Œ ì„±ê²©</label>
  <select name="personality">
    <option value="soyang">ì™¸í–¥ì ì´ê³  ê¸‰í•œ ì„±ê²©</option>
    <option value="taeyang">í™œë™ì ì´ê³  ì˜ìš•ì€ ë§ì§€ë§Œ ì‰½ê²Œ í”¼ë¡œ</option>
    <option value="soeum">ë‚´í–¥ì ì´ê³  ì¡°ìš©í•˜ë©° ì˜ˆë¯¼</option>
    <option value="taeeum">ì°¨ë¶„í•˜ê³  ì°¸ì„ì„±ì´ ë§ìœ¼ë©° ëŠê¸‹í•¨</option>
  </select>
</div>

<div class="section"><label>ì‹ìš• ìƒíƒœ</label>
  <select name="appetite">
    <option value="taeeum">ì‹ìš•ì´ ì™•ì„±í•˜ê³  ì˜ ë¨¹ëŠ” í¸</option>
    <option value="soeum">ì†Œí™”ê°€ ì˜ ì•ˆë˜ê³  ìì£¼ ì²´í•¨</option>
    <option value="soyang">ê¸ˆë°© ë°°ê³ í”„ê³  ìì£¼ ë¨¹ì§€ë§Œ ë³€ì´ ë¬´ë¥´ê±°ë‚˜ ë¬½ìŒ</option>
    <option value="taeyang">ì¡°ê¸ˆë§Œ ë¨¹ì–´ë„ ì†ì´ ë”ë¶€ë£©í•¨</option>
  </select>
</div>

<div class="section"><label>ì²´í˜•ì  íŠ¹ì§•</label>
  <select name="bodyshape">
    <option value="taeeum">ëª¸ì§‘ì´ í¬ê³  ì‚´ì´ ì˜ ì°ŒëŠ” í¸</option>
    <option value="soeum">ë§ˆë¥´ê³  ì²´ë ¥ì´ ì•½í•œ í¸</option>
    <option value="soyang">ìƒì²´ê°€ ë°œë‹¬ë˜ê³  í•˜ì²´ê°€ ë¹ˆì•½</option>
    <option value="taeyang">íŒ”ë‹¤ë¦¬ê°€ ê°€ëŠ˜ê³  ì–¼êµ´ì´ ë¶‰ê±°ë‚˜ ì—´ì´ ë§ìŒ</option>
  </select>
</div>
<button class="btn" onclick="generateReport()" type="button">ë¦¬í¬íŠ¸ ìƒì„±</button>
</form>
</div>
<div id="reportPage">
<h2>ğŸ“Š ë¶„ì„ ê²°ê³¼</h2>
<div class="output" id="userInfo"></div>
<div class="output" id="report"></div>
<canvas height="300" id="chart" width="600"></canvas>
<div class="output" id="recommend"></div><div class="output" id="guide"></div>
<canvas id="scoreChart"></canvas>
<h3>ğŸ“ˆ ì¼ì£¼ì¼ ë³€í™” ì¶”ì´</h3><canvas height="300" id="trendChart" style="margin-top:30px;" width="600"></canvas> width="600" height="300"&gt;
</div>
<script>
function goToMainPage() {
  const userData = {
    name: document.getElementById("name").value,
    age: document.getElementById("age").value,
    gender: document.getElementById("gender").value,
    height: document.getElementById("height").value,
    weight: document.getElementById("weight").value
  };
  localStorage.setItem("userData", JSON.stringify(userData));
  document.getElementById("introPage").style.display = "none";
  document.getElementById("mainPage").style.display = "block";
}

function generateReport() {
  const userData = JSON.parse(localStorage.getItem("userData"));
  const heightM = userData.height / 100;
  const bmi = (userData.weight / (heightM * heightM)).toFixed(1);
  let bmiMsg = "";
  if (bmi < 18.5) bmiMsg = "ì €ì²´ì¤‘: ê·¼ìœ¡ëŸ‰ ë° ì˜ì–‘ ìƒíƒœ ì ê²€ í•„ìš”";
  else if (bmi < 23) bmiMsg = "ì •ìƒ ì²´ì¤‘: í˜„ì¬ ìƒíƒœ ìœ ì§€";
  else if (bmi < 25) bmiMsg = "ê³¼ì²´ì¤‘: ìš´ë™ê³¼ ì‹ì´ì¡°ì ˆ í•„ìš”";
  else bmiMsg = "ë¹„ë§Œ: ì²´ì¤‘ ì¡°ì ˆê³¼ ìƒí™œìŠµê´€ ê°œì„  í•„ìš”";

  let userInfo = `<h3>ğŸ‘¤ ì…ë ¥í•œ ì‹ ìƒ ì •ë³´</h3><ul>
    <li>ì´ë¦„: ${userData.name}</li>
    <li>ë‚˜ì´: ${userData.age}</li>
    <li>ì„±ë³„: ${userData.gender}</li>
    <li>í‚¤: ${userData.height} cm</li>
    <li>ëª¸ë¬´ê²Œ: ${userData.weight} kg</li>
    <li><strong>BMI: ${bmi}</strong> â†’ ${bmiMsg}</li>
  </ul>`;
  document.getElementById("userInfo").innerHTML = userInfo;

  document.getElementById("mainPage").style.display = "none";
  document.getElementById("reportPage").style.display = "block";

  const f = document.forms["healthForm"];
  const scores = { ê¸°ì²´: 0, í˜ˆí—ˆ: 0, ìŒí—ˆ: 0, ì‹ì : 0, ê°„ê¸°ìš¸ê²°: 0 };
  const today = new Date().toISOString().slice(0, 10);
  const record = { date: today, scores };
  let history = JSON.parse(localStorage.getItem("scoreHistory")) || [];
  history = history.filter(h => h.date !== today);
  history.push(record);
  localStorage.setItem("scoreHistory", JSON.stringify(history));


  const bf = parseInt(f["bowel_freq"].value);
  const bs = parseInt(f["bowel_satisfaction"].value);
  const uf = parseInt(f["urine_freq"].value);
  const st = parseInt(f["sleep_time"].value);
  const sq = parseInt(f["sleep_quality"].value);
  const ma = parseInt(f["meal_amount"].value);
  const dd = parseInt(f["digest_discomfort"].value);
  const em = parseInt(f["emotion"].value);

  if (bf === 0) scores["ê¸°ì²´"] += 2;
  else if (bf === 1) scores["ê¸°ì²´"] += 1;
  if (bs <= 2) scores["ê¸°ì²´"] += 1;

  if (st <= 3) scores["í˜ˆí—ˆ"] += 2;
  else if (st <= 5) scores["í˜ˆí—ˆ"] += 1;
  if (sq <= 2) scores["í˜ˆí—ˆ"] += 1;
  if (ma === 1) scores["í˜ˆí—ˆ"] += 2;
  else if (ma === 2) scores["í˜ˆí—ˆ"] += 1;

  if (uf >= 9) scores["ìŒí—ˆ"] += 2;
  else if (uf >= 7) scores["ìŒí—ˆ"] += 1;

  if (dd >= 4) scores["ì‹ì "] += 2;
  else if (dd === 3) scores["ì‹ì "] += 1;
  if (ma === 5) scores["ì‹ì "] += 2;
  else if (ma === 4) scores["ì‹ì "] += 1;

  if (em === 1) scores["ê°„ê¸°ìš¸ê²°"] += 2;
  else if (em === 2) scores["ê°„ê¸°ìš¸ê²°"] += 1;

  let report = "<h3>ì²´ì§ˆ ì ìˆ˜</h3><ul>";
  for (let k in scores) {
    report += `<li><strong>${k}</strong>: ${scores[k]}ì </li>`;
  }
  report += "</ul>";
  document.getElementById("report").innerHTML = report;

  

  // ğŸ” íŒ”ê°•ë³€ì¦ ê°’ ìˆ˜ì§‘
  const pyo_li = parseInt(f["pyo_li"].value);
  const han_yeol = parseInt(f["han_yeol"].value);
  const heo_sil = parseInt(f["heo_sil"].value);
  const eum_yang = parseInt(f["eum_yang"].value);

  let palgangReport = "<h3>íŒ”ê°•ë³€ì¦ ë¶„ì„</h3><ul>";
  if (pyo_li === 0) {
    palgangReport += "<li><strong>í‘œì¦</strong>: ì™¸ë¶€ ìê·¹ì— ë¯¼ê°. ë°”ëŒê³¼ ì°¬ ê¸°ìš´ ì£¼ì˜</li>";
  } else {
    palgangReport += "<li><strong>ë¦¬ì¦</strong>: ë‚´ë¶€ ì¥ê¸° ê¸°ëŠ¥ ì£¼ì˜. ë”°ëœ»í•œ ìŒì‹ ì„­ì·¨ ê¶Œì¥</li>";
  }
  if (han_yeol === 0) {
    palgangReport += "<li><strong>í•œì¦</strong>: ì¶”ìœ„ë¥¼ ë§ì´ ëŠë‚Œ. ë”°ëœ»í•œ ìŒì‹ê³¼ ìƒê°•ì°¨ ê¶Œì¥</li>";
  } else {
    palgangReport += "<li><strong>ì—´ì¦</strong>: ë”ìœ„ë¥¼ ëŠë‚Œ. ìˆ˜ë¶„ ì„­ì·¨ì™€ ì—´ì„± ìŒì‹ ìì œ</li>";
  }
  if (heo_sil === 0) {
    palgangReport += "<li><strong>í—ˆì¦</strong>: ê¸°ë ¥ì´ ë¶€ì¡±. íœ´ì‹ê³¼ ì˜ì–‘ ì„­ì·¨ í•„ìš”</li>";
  } else {
    palgangReport += "<li><strong>ì‹¤ì¦</strong>: ëª¸ì— ê¸´ì¥ê³¼ ê³¼ì‰. ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œì™€ ì´ì™„ ìš”ë²• ê¶Œì¥</li>";
  }
  if (eum_yang === 0) {
    palgangReport += "<li><strong>ìŒì„± ê²½í–¥</strong>: ë‚´í–¥ì ì´ê³  ì˜ˆë¯¼. ë§ˆìŒ ì•ˆì •ì´ ì¤‘ìš”</li>";
  } else {
    palgangReport += "<li><strong>ì–‘ì„± ê²½í–¥</strong>: ì™¸í–¥ì ì´ê³  í™œë™ì . ê³¼ë„í•œ í–‰ë™ì€ ìì œ</li>";
  }
  palgangReport += "</ul>";
  document.getElementById("report").innerHTML += palgangReport;

  // ğŸ” ì‚¬ìƒì²´ì§ˆ íŒë³„
  const sasangVotes = { íƒœì–‘ì¸: 0, ì†Œì–‘ì¸: 0, íƒœìŒì¸: 0, ì†ŒìŒì¸: 0 };
  const personality = f["personality"].value;
  const appetite = f["appetite"].value;
  const bodyshape = f["bodyshape"].value;

  const mapping = {
    soyang: "ì†Œì–‘ì¸",
    soeum: "ì†ŒìŒì¸",
    taeyang: "íƒœì–‘ì¸",
    taeeum: "íƒœìŒì¸"
  };

  sasangVotes[mapping[personality]]++;
  sasangVotes[mapping[appetite]]++;
  sasangVotes[mapping[bodyshape]]++;

  let maxVotes = 0;
  let finalType = "";
  for (let k in sasangVotes) {
    if (sasangVotes[k] > maxVotes) {
      maxVotes = sasangVotes[k];
      finalType = k;
    }
  }

  let sasangReport = "<h3>ì‚¬ìƒì²´ì§ˆ ë¶„ì„</h3>";
  sasangReport += `<p><strong>íŒë³„ëœ ì²´ì§ˆ: ${finalType}</strong></p>`;
  sasangReport += "<ul>";
  if (finalType === "íƒœì–‘ì¸") {
    sasangReport += "<li>ê°„ ê¸°ëŠ¥ ê°•í™” í•„ìš”. ë“±ì‚°, ìˆ¨ì‰¬ê¸° ìš´ë™ ì¶”ì²œ</li>";
    sasangReport += "<li>ê¸°ë¦„ê¸° ë§ì€ ìŒì‹ì€ í”¼í•˜ê³ , ë‹´ë°±í•œ ìŒì‹ ì„­ì·¨</li>";
    sasangReport += "<li><strong>ì¶”ì²œ í•œì•½</strong>: ì˜¤ê°€í”¼íƒ•, ìš°í™©ì²­ì‹¬ì›</li>";
  } else if (finalType === "ì†Œì–‘ì¸") {
    sasangReport += "<li>ì‹¬ì¥ê³¼ ë¹„ì¥ ë³´í˜¸, ê³¼ë¡œ ê¸ˆì§€</li>";
    sasangReport += "<li>ë§¤ìš´ ìŒì‹, ì¹´í˜ì¸ ì„­ì·¨ ìì œ</li>";
    sasangReport += "<li><strong>ì¶”ì²œ í•œì•½</strong>: í˜•ë°©ì§€í™©íƒ•, ì‹œí˜¸ì²­ê°„íƒ•</li>";
  } else if (finalType === "íƒœìŒì¸") {
    sasangReport += "<li>íê¸°ëŠ¥ ê°•í™”, ë•€ ë°°ì¶œì„ ìœ„í•œ ìœ ì‚°ì†Œ ìš´ë™ í•„ìš”</li>";
    sasangReport += "<li>ê¸°ë¦„ì§„ ìŒì‹ ì¡°ì ˆ, ì‹ì´ ì„¬ìœ  ì„­ì·¨ ì¦ê°€</li>";
    sasangReport += "<li><strong>ì¶”ì²œ í•œì•½</strong>: íƒœìŒì¡°ìœ„íƒ•, ì²­ì‹¬ì—°ììŒ</li>";
  } else if (finalType === "ì†ŒìŒì¸") {
    sasangReport += "<li>ìœ„ì¥ ê¸°ëŠ¥ ë³´í˜¸. ë¬´ë¦¬í•œ ìš´ë™ í”¼í•˜ê¸°</li>";
    sasangReport += "<li>ë”°ëœ»í•˜ê³  ì†Œí™” ì˜ ë˜ëŠ” ìŒì‹ ì„­ì·¨</li>";
    sasangReport += "<li><strong>ì¶”ì²œ í•œì•½</strong>: ê³½í–¥ì •ê¸°ì‚°, ë³´ì¤‘ìµê¸°íƒ•</li>";
  }
  sasangReport += "</ul>";
  document.getElementById("report").innerHTML += sasangReport;


let guide = "<h3>ìƒí™œ ê°€ì´ë“œ</h3><ul>";
  const s = scores;
  if (s["ê¸°ì²´"] === 1) guide += "<li>ê¸° ìˆœí™˜ ì•½ê°„ ì •ì²´. ë³µë¶€ ë§ˆì‚¬ì§€ ì¶”ì²œ</li>";
  if (s["ê¸°ì²´"] >= 2) guide += "<li>ê¸°ì²´ ì‹¬í™”. ê·œì¹™ì  ì‹ì‚¬ì™€ ìš´ë™ í•„ìš”</li>";
  if (s["í˜ˆí—ˆ"] === 1) guide += "<li>ì—ë„ˆì§€ ì†Œëª¨ ì£¼ì˜. íœ´ì‹ ê°•í™”</li>";
  if (s["í˜ˆí—ˆ"] >= 2) guide += "<li>í˜ˆí—ˆ ê²½í–¥. ìˆ™ë©´ + ì² ë¶„ ë³´ì¶© ì‹ë‹¨ í•„ìš”</li>";
  if (s["ìŒí—ˆ"] === 1) guide += "<li>ë¬¼ ìì£¼ ë§ˆì‹œê³ , ì•¼ê°„ í™œë™ ì¤„ì´ê¸°</li>";
  if (s["ìŒí—ˆ"] >= 2) guide += "<li>ìŒí—ˆ ì‹¬í™”. ìˆ˜ë¶„ ì„­ì·¨ + ê³¼ë¡œ ê¸ˆì§€</li>";
  if (s["ì‹ì "] === 1) guide += "<li>ì†Œí™” ë¶ˆí¸ ì•½ê°„ ìˆìŒ. ì‹ì‚¬ëŸ‰ ì¡°ì ˆ í•„ìš”</li>";
  if (s["ì‹ì "] >= 2) guide += "<li>ì‹ì  ì‹¬í™”. ì ˆì‹ ë° ìê·¹ì  ìŒì‹ í”¼í•˜ê¸°</li>";
  if (s["ê°„ê¸°ìš¸ê²°"] === 1) guide += "<li>ê°ì • ì¡°ì ˆ í•„ìš”. ì‚°ì±…, ìŒì•… ì¶”ì²œ</li>";
  if (s["ê°„ê¸°ìš¸ê²°"] >= 2) guide += "<li>ì •ì„œ ë¶ˆì•ˆì •. ëª…ìƒ, ì¼ê¸°, ëŒ€í™” í™œìš©</li>";
  if (Object.values(s).every(v => v === 0)) guide += "<li>ê· í˜• ì¡íŒ ìƒíƒœì…ë‹ˆë‹¤. í˜„ì¬ ìƒí™œìŠµê´€ ìœ ì§€í•˜ì„¸ìš”.</li>";
  guide += "</ul>";
  document.getElementById("guide").innerHTML = guide;

  let prescriptions = [];
  if (scores["ê¸°ì²´"] >= 2)
    prescriptions.push("<strong>í–¥ì†Œì‚° / ì‹œí˜¸ì†Œê°„íƒ• / ë°˜í•˜í›„ë°•íƒ•</strong>: ê¸°ìˆœí™˜ì„ ë„ì™€ ê°€ìŠ´ ë‹µë‹µí•¨ì„ ê°œì„ í•©ë‹ˆë‹¤.");
  if (scores["í˜ˆí—ˆ"] >= 2)
    prescriptions.push("<strong>ë‹¹ê·€ë³´í˜ˆíƒ• / íŒ”ë¬¼íƒ• / ê·€ë¹„íƒ•</strong>: í˜ˆì„ ë³´í•˜ê³  ê¸°ìš´ì„ ë¶ë‹ì•„ì¤ë‹ˆë‹¤.");
  if (scores["ìŒí—ˆ"] >= 2)
    prescriptions.push("<strong>ììŒê°•í™”íƒ• / ìœ¡ë¯¸ì§€í™©íƒ• / ì²­ì‹¬ì—°ììŒ</strong>: ì²´ë‚´ ìŒì„ ë³´ì¶©í•˜ê³  ì—´ê°ì„ ì‹í˜€ì¤ë‹ˆë‹¤.");
  if (scores["ì‹ì "] >= 2)
    prescriptions.push("<strong>í‰ìœ„ì‚° / ì§€ì‹¤ë„ì²´í™˜ / ëª©í–¥ë¹ˆë‘í™˜</strong>: ìœ„ì¥ ê¸°ëŠ¥ì„ ê°œì„ í•˜ê³  ì ì²´ë¥¼ í’€ì–´ì¤ë‹ˆë‹¤.");
  if (scores["ê°„ê¸°ìš¸ê²°"] >= 2)
    prescriptions.push("<strong>ê°€ë¯¸ì†Œìš”ì‚° / ì‹œí˜¸ì†Œê°„íƒ• / ì²œì™•ë³´ì‹¬ë‹¨</strong>: ê°ì • ì–µì œë¥¼ ì™„í™”í•˜ê³  ê°„ê¸°ìˆœí™˜ì„ ë„ì™€ì¤ë‹ˆë‹¤.");

  let recommendation = prescriptions.length > 0
    ? "<h3>ğŸ“¦ ì¶”ì²œ í•œì•½</h3><ul>" + prescriptions.map(p => `<li>${p}</li>`).join("") + "</ul>"
    : "<h3>ğŸ“¦ ì¶”ì²œ í•œì•½</h3><p>í˜„ì¬ ìƒíƒœì—ì„œëŠ” íŠ¹ë³„í•œ ì²˜ë°©ì´ í•„ìš”í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>";

  document.getElementById("recommend").innerHTML = recommendation;


  if (window.myChart) window.myChart.destroy();
  const ctx = document.getElementById("chart").getContext("2d");
  window.myChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: Object.keys(scores),
      datasets: [{
        label: 'ì²´ì§ˆ ì ìˆ˜',
        data: Object.values(scores),
        backgroundColor: 'rgba(75, 192, 192, 0.6)'
      }]
    },
    options: {
      scales: { y: { beginAtZero: true, max: 6 } }
    }
  });
  function getColorForKey(key) {
    const colors = {
      ê¸°ì²´: '#007bff',
      í˜ˆí—ˆ: '#e83e8c',
      ìŒí—ˆ: '#28a745',
      ì‹ì : '#fd7e14',
      ê°„ê¸°ìš¸ê²°: '#6f42c1'
    };
    return colors[key] || '#999';
  }

  const trendCtx = document.getElementById("trendChart").getContext("2d");
  const last7 = history.slice(-7);
  const labels = last7.map(d => d.date);
  const datasets = Object.keys(scores).map(key => ({
    label: key,
    data: last7.map(d => d.scores[key] || 0),
    fill: false,
    borderColor: getColorForKey(key),
    tension: 0.3
  }));

  new Chart(trendCtx, {
    type: 'line',
    data: { labels, datasets },
    options: {
      scales: { y: { beginAtZero: true, max: 6 } },
      plugins: { legend: { position: 'bottom' } }
    }
  });

}
</script>
</body>
</html>