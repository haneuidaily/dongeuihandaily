<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<title>氣象</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    .section { margin-bottom: 20px; }
    label { display: block; font-weight: bold; margin-bottom: 6px; }
    input, select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    input[type="range"] { height: 10px; }
    .range-wrapper { position: relative; }
    .range-labels-absolute {
      position: absolute;
      top: 30px;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      font-size: 0.85em;
    }
    .range-labels-absolute span {
      transform: translateX(-50%);
      width: 20px;
      text-align: center;
    }
    .btn {
      padding: 15px 30px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      display: block;
      margin: 30px auto;
    }
    .output {
      margin-top: 20px;
      padding: 12px;
      background: #f2f2f2;
      border-radius: 8px;
    }
    #mainPage, #reportPage { display: none; }
  </style>
</head>
<body>
<div style="text-align: center; margin-bottom: 30px;">
<h1 style="font-size: 2.5em; margin: 0;">氣象</h1>
<div style="font-size: 1.1em; color: #555;">한의 데일리 리포트</div>
</div>
<div id="introPage">
<h2>👤 기본 정보 입력</h2>
<div class="section"><label>이름<input id="name" type="text"/></label></div>
<div class="section"><label>나이<input id="age" type="number"/></label></div>
<div class="section"><label>성별<select id="gender"><option>남</option><option>여</option></select></label></div>
<div class="section"><label>키 (cm)<input id="height" type="number"/></label></div>
<div class="section"><label>몸무게 (kg)<input id="weight" type="number"/></label></div>
<button class="btn" onclick="goToMainPage()">입력 완료</button>
</div>
<div id="mainPage">
<h2>📋 건강 정보 입력</h2>
<form id="healthForm">
<div class="section"><label>대변 빈도</label>
<div class="range-wrapper"><input max="3" min="0" name="bowel_freq" type="range" value="1"/>
<div class="range-labels-absolute"><span>0</span><span>1</span><span>2</span><span>3</span></div></div></div>
<div class="section"><label>대변 시원함</label>
<div class="range-wrapper"><input max="5" min="1" name="bowel_satisfaction" type="range" value="3"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>
<div class="section"><label>소변 빈도</label>
<div class="range-wrapper"><input max="10" min="1" name="urine_freq" type="range" value="5"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span></div></div></div>
<div class="section"><label>수면 시간</label>
<div class="range-wrapper"><input max="12" min="0" name="sleep_time" type="range" value="6"/>
<div class="range-labels-absolute"><span>0</span><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span><span>11</span><span>12</span></div></div></div>
<div class="section"><label>수면의 질</label>
<div class="range-wrapper"><input max="5" min="1" name="sleep_quality" type="range" value="3"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>
<div class="section"><label>식사량</label>
<div class="range-wrapper"><input max="5" min="1" name="meal_amount" type="range" value="3"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>
<div class="section"><label>식후 불편감</label>
<div class="range-wrapper"><input max="5" min="1" name="digest_discomfort" type="range" value="2"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>
<div class="section"><label>감정 상태</label>
<div class="range-wrapper"><input max="5" min="1" name="emotion" type="range" value="3"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>
<button class="btn" onclick="generateReport()" type="button">리포트 생성</button>
</form>
</div>
<div id="reportPage">
<h2>📊 분석 결과</h2>
<div class="output" id="userInfo"></div>
<div class="output" id="report"></div>
<canvas height="300" id="chart" width="600"></canvas>
<div class="output" id="guide"></div>
<canvas id="scoreChart"></canvas>
<h3>📈 일주일 변화 추이</h3><canvas height="300" id="trendChart" style="margin-top:30px;" width="600"></canvas> width="600" height="300"&gt;
</div>
<script>
function goToMainPage() {
  const userData = {
    name: document.getElementById("name").value,
    age: document.getElementById("age").value,
    gender: document.getElementById("gender").value,
    height: document.getElementById("height").value,
    weight: document.getElementById("weight").value
  };
  localStorage.setItem("userData", JSON.stringify(userData));
  document.getElementById("introPage").style.display = "none";
  document.getElementById("mainPage").style.display = "block";
}

function generateReport() {
  const userData = JSON.parse(localStorage.getItem("userData"));
  const heightM = userData.height / 100;
  const bmi = (userData.weight / (heightM * heightM)).toFixed(1);
  let bmiMsg = "";
  if (bmi < 18.5) bmiMsg = "저체중: 근육량 및 영양 상태 점검 필요";
  else if (bmi < 23) bmiMsg = "정상 체중: 현재 상태 유지";
  else if (bmi < 25) bmiMsg = "과체중: 운동과 식이조절 필요";
  else bmiMsg = "비만: 체중 조절과 생활습관 개선 필요";

  let userInfo = `<h3>👤 입력한 신상 정보</h3><ul>
    <li>이름: ${userData.name}</li>
    <li>나이: ${userData.age}</li>
    <li>성별: ${userData.gender}</li>
    <li>키: ${userData.height} cm</li>
    <li>몸무게: ${userData.weight} kg</li>
    <li><strong>BMI: ${bmi}</strong> → ${bmiMsg}</li>
  </ul>`;
  document.getElementById("userInfo").innerHTML = userInfo;

  document.getElementById("mainPage").style.display = "none";
  document.getElementById("reportPage").style.display = "block";

  const f = document.forms["healthForm"];
  const scores = { 기체: 0, 혈허: 0, 음허: 0, 식적: 0, 간기울결: 0 };
  const today = new Date().toISOString().slice(0, 10);
  const record = { date: today, scores };
  let history = JSON.parse(localStorage.getItem("scoreHistory")) || [];
  history = history.filter(h => h.date !== today);
  history.push(record);
  localStorage.setItem("scoreHistory", JSON.stringify(history));


  const bf = parseInt(f["bowel_freq"].value);
  const bs = parseInt(f["bowel_satisfaction"].value);
  const uf = parseInt(f["urine_freq"].value);
  const st = parseInt(f["sleep_time"].value);
  const sq = parseInt(f["sleep_quality"].value);
  const ma = parseInt(f["meal_amount"].value);
  const dd = parseInt(f["digest_discomfort"].value);
  const em = parseInt(f["emotion"].value);

  if (bf === 0) scores["기체"] += 2;
  else if (bf === 1) scores["기체"] += 1;
  if (bs <= 2) scores["기체"] += 1;

  if (st <= 3) scores["혈허"] += 2;
  else if (st <= 5) scores["혈허"] += 1;
  if (sq <= 2) scores["혈허"] += 1;
  if (ma === 1) scores["혈허"] += 2;
  else if (ma === 2) scores["혈허"] += 1;

  if (uf >= 9) scores["음허"] += 2;
  else if (uf >= 7) scores["음허"] += 1;

  if (dd >= 4) scores["식적"] += 2;
  else if (dd === 3) scores["식적"] += 1;
  if (ma === 5) scores["식적"] += 2;
  else if (ma === 4) scores["식적"] += 1;

  if (em === 1) scores["간기울결"] += 2;
  else if (em === 2) scores["간기울결"] += 1;

  let report = "<h3>체질 점수</h3><ul>";
  for (let k in scores) {
    report += `<li><strong>${k}</strong>: ${scores[k]}점</li>`;
  }
  report += "</ul>";
  document.getElementById("report").innerHTML = report;

  let guide = "<h3>생활 가이드</h3><ul>";
  const s = scores;
  if (s["기체"] === 1) guide += "<li>기 순환 약간 정체. 복부 마사지 추천</li>";
  if (s["기체"] >= 2) guide += "<li>기체 심화. 규칙적 식사와 운동 필요</li>";
  if (s["혈허"] === 1) guide += "<li>에너지 소모 주의. 휴식 강화</li>";
  if (s["혈허"] >= 2) guide += "<li>혈허 경향. 숙면 + 철분 보충 식단 필요</li>";
  if (s["음허"] === 1) guide += "<li>물 자주 마시고, 야간 활동 줄이기</li>";
  if (s["음허"] >= 2) guide += "<li>음허 심화. 수분 섭취 + 과로 금지</li>";
  if (s["식적"] === 1) guide += "<li>소화 불편 약간 있음. 식사량 조절 필요</li>";
  if (s["식적"] >= 2) guide += "<li>식적 심화. 절식 및 자극적 음식 피하기</li>";
  if (s["간기울결"] === 1) guide += "<li>감정 조절 필요. 산책, 음악 추천</li>";
  if (s["간기울결"] >= 2) guide += "<li>정서 불안정. 명상, 일기, 대화 활용</li>";
  if (Object.values(s).every(v => v === 0)) guide += "<li>균형 잡힌 상태입니다. 현재 생활습관 유지하세요.</li>";
  guide += "</ul>";
  document.getElementById("guide").innerHTML = guide;

  if (window.myChart) window.myChart.destroy();
  const ctx = document.getElementById("chart").getContext("2d");
  window.myChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: Object.keys(scores),
      datasets: [{
        label: '체질 점수',
        data: Object.values(scores),
        backgroundColor: 'rgba(75, 192, 192, 0.6)'
      }]
    },
    options: {
      scales: { y: { beginAtZero: true, max: 6 } }
    }
  });
  function getColorForKey(key) {
    const colors = {
      기체: '#007bff',
      혈허: '#e83e8c',
      음허: '#28a745',
      식적: '#fd7e14',
      간기울결: '#6f42c1'
    };
    return colors[key] || '#999';
  }

  const trendCtx = document.getElementById("trendChart").getContext("2d");
  const last7 = history.slice(-7);
  const labels = last7.map(d => d.date);
  const datasets = Object.keys(scores).map(key => ({
    label: key,
    data: last7.map(d => d.scores[key] || 0),
    fill: false,
    borderColor: getColorForKey(key),
    tension: 0.3
  }));

  new Chart(trendCtx, {
    type: 'line',
    data: { labels, datasets },
    options: {
      scales: { y: { beginAtZero: true, max: 6 } },
      plugins: { legend: { position: 'bottom' } }
    }
  });

}
</script>
</body>
</html>