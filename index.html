<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<title>æ°£è±¡</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    .section { margin-bottom: 20px; }
    label { display: block; font-weight: bold; margin-bottom: 6px; }
    input, select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    input[type="range"] { height: 10px; }
    .range-wrapper { position: relative; }
    .range-labels-absolute {
      position: absolute;
      top: 30px;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      font-size: 0.85em;
    }
    .range-labels-absolute span {
      transform: translateX(-50%);
      width: 20px;
      text-align: center;
    }
    .btn {
      padding: 15px 30px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      display: block;
      margin: 30px auto;
    }
    .output {
      margin-top: 20px;
      padding: 12px;
      background: #f2f2f2;
      border-radius: 8px;
    }
    #mainPage, #reportPage { display: none; }
  </style>
</head>
<body>
<div style="text-align: center; margin-bottom: 30px;">
<h1 style="font-size: 2.5em; margin: 0;">æ°£è±¡</h1>
<div style="font-size: 1.1em; color: #555;">í•œì˜ ë°ì¼ë¦¬ ë¦¬í¬íŠ¸</div>
</div>
<div id="introPage">
<h2>ğŸ‘¤ ê¸°ë³¸ ì •ë³´ ì…ë ¥</h2>
<div class="section"><label>ì´ë¦„<input id="name" type="text"/></label></div>
<div class="section"><label>ë‚˜ì´<input id="age" type="number"/></label></div>
<div class="section"><label>ì„±ë³„<select id="gender"><option>ë‚¨</option><option>ì—¬</option></select></label></div>
<div class="section"><label>í‚¤ (cm)<input id="height" type="number"/></label></div>
<div class="section"><label>ëª¸ë¬´ê²Œ (kg)<input id="weight" type="number"/></label></div>
<button class="btn" onclick="goToMainPage()">ì…ë ¥ ì™„ë£Œ</button>
</div>
<div id="mainPage">
<h2>ğŸ“‹ ê±´ê°• ì •ë³´ ì…ë ¥</h2>
<form id="healthForm">
<div class="section"><label>ëŒ€ë³€ ë¹ˆë„</label>
<div class="range-wrapper"><input max="3" min="0" name="bowel_freq" type="range" value="1"/>
<div class="range-labels-absolute"><span>0</span><span>1</span><span>2</span><span>3</span></div></div></div>
<div class="section"><label>ëŒ€ë³€ ì‹œì›í•¨</label>
<div class="range-wrapper"><input max="5" min="1" name="bowel_satisfaction" type="range" value="3"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>
<div class="section"><label>ì†Œë³€ ë¹ˆë„</label>
<div class="range-wrapper"><input max="10" min="1" name="urine_freq" type="range" value="5"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span></div></div></div>
<div class="section"><label>ìˆ˜ë©´ ì‹œê°„</label>
<div class="range-wrapper"><input max="12" min="0" name="sleep_time" type="range" value="6"/>
<div class="range-labels-absolute"><span>0</span><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span><span>11</span><span>12</span></div></div></div>
<div class="section"><label>ìˆ˜ë©´ì˜ ì§ˆ</label>
<div class="range-wrapper"><input max="5" min="1" name="sleep_quality" type="range" value="3"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>
<div class="section"><label>ì‹ì‚¬ëŸ‰</label>
<div class="range-wrapper"><input max="5" min="1" name="meal_amount" type="range" value="3"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>
<div class="section"><label>ì‹í›„ ë¶ˆí¸ê°</label>
<div class="range-wrapper"><input max="5" min="1" name="digest_discomfort" type="range" value="2"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>
<div class="section"><label>ê°ì • ìƒíƒœ</label>
<div class="range-wrapper"><input max="5" min="1" name="emotion" type="range" value="3"/>
<div class="range-labels-absolute"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div></div></div>
<button class="btn" onclick="generateReport()" type="button">ë¦¬í¬íŠ¸ ìƒì„±</button>
</form>
</div>
<div id="reportPage">
<h2>ğŸ“Š ë¶„ì„ ê²°ê³¼</h2>
<div class="output" id="userInfo"></div>
<div class="output" id="report"></div>
<canvas height="300" id="chart" width="600"></canvas>
<div class="output" id="guide"></div>
<canvas id="scoreChart"></canvas>
<h3>ğŸ“ˆ ì¼ì£¼ì¼ ë³€í™” ì¶”ì´</h3><canvas height="300" id="trendChart" style="margin-top:30px;" width="600"></canvas> width="600" height="300"&gt;
</div>
<script>
function goToMainPage() {
  const userData = {
    name: document.getElementById("name").value,
    age: document.getElementById("age").value,
    gender: document.getElementById("gender").value,
    height: document.getElementById("height").value,
    weight: document.getElementById("weight").value
  };
  localStorage.setItem("userData", JSON.stringify(userData));
  document.getElementById("introPage").style.display = "none";
  document.getElementById("mainPage").style.display = "block";
}

function generateReport() {
  const userData = JSON.parse(localStorage.getItem("userData"));
  const heightM = userData.height / 100;
  const bmi = (userData.weight / (heightM * heightM)).toFixed(1);
  let bmiMsg = "";
  if (bmi < 18.5) bmiMsg = "ì €ì²´ì¤‘: ê·¼ìœ¡ëŸ‰ ë° ì˜ì–‘ ìƒíƒœ ì ê²€ í•„ìš”";
  else if (bmi < 23) bmiMsg = "ì •ìƒ ì²´ì¤‘: í˜„ì¬ ìƒíƒœ ìœ ì§€";
  else if (bmi < 25) bmiMsg = "ê³¼ì²´ì¤‘: ìš´ë™ê³¼ ì‹ì´ì¡°ì ˆ í•„ìš”";
  else bmiMsg = "ë¹„ë§Œ: ì²´ì¤‘ ì¡°ì ˆê³¼ ìƒí™œìŠµê´€ ê°œì„  í•„ìš”";

  let userInfo = `<h3>ğŸ‘¤ ì…ë ¥í•œ ì‹ ìƒ ì •ë³´</h3><ul>
    <li>ì´ë¦„: ${userData.name}</li>
    <li>ë‚˜ì´: ${userData.age}</li>
    <li>ì„±ë³„: ${userData.gender}</li>
    <li>í‚¤: ${userData.height} cm</li>
    <li>ëª¸ë¬´ê²Œ: ${userData.weight} kg</li>
    <li><strong>BMI: ${bmi}</strong> â†’ ${bmiMsg}</li>
  </ul>`;
  document.getElementById("userInfo").innerHTML = userInfo;

  document.getElementById("mainPage").style.display = "none";
  document.getElementById("reportPage").style.display = "block";

  const f = document.forms["healthForm"];
  const scores = { ê¸°ì²´: 0, í˜ˆí—ˆ: 0, ìŒí—ˆ: 0, ì‹ì : 0, ê°„ê¸°ìš¸ê²°: 0 };
  const today = new Date().toISOString().slice(0, 10);
  const record = { date: today, scores };
  let history = JSON.parse(localStorage.getItem("scoreHistory")) || [];
  history = history.filter(h => h.date !== today);
  history.push(record);
  localStorage.setItem("scoreHistory", JSON.stringify(history));


  const bf = parseInt(f["bowel_freq"].value);
  const bs = parseInt(f["bowel_satisfaction"].value);
  const uf = parseInt(f["urine_freq"].value);
  const st = parseInt(f["sleep_time"].value);
  const sq = parseInt(f["sleep_quality"].value);
  const ma = parseInt(f["meal_amount"].value);
  const dd = parseInt(f["digest_discomfort"].value);
  const em = parseInt(f["emotion"].value);

  if (bf === 0) scores["ê¸°ì²´"] += 2;
  else if (bf === 1) scores["ê¸°ì²´"] += 1;
  if (bs <= 2) scores["ê¸°ì²´"] += 1;

  if (st <= 3) scores["í˜ˆí—ˆ"] += 2;
  else if (st <= 5) scores["í˜ˆí—ˆ"] += 1;
  if (sq <= 2) scores["í˜ˆí—ˆ"] += 1;
  if (ma === 1) scores["í˜ˆí—ˆ"] += 2;
  else if (ma === 2) scores["í˜ˆí—ˆ"] += 1;

  if (uf >= 9) scores["ìŒí—ˆ"] += 2;
  else if (uf >= 7) scores["ìŒí—ˆ"] += 1;

  if (dd >= 4) scores["ì‹ì "] += 2;
  else if (dd === 3) scores["ì‹ì "] += 1;
  if (ma === 5) scores["ì‹ì "] += 2;
  else if (ma === 4) scores["ì‹ì "] += 1;

  if (em === 1) scores["ê°„ê¸°ìš¸ê²°"] += 2;
  else if (em === 2) scores["ê°„ê¸°ìš¸ê²°"] += 1;

  let report = "<h3>ì²´ì§ˆ ì ìˆ˜</h3><ul>";
  for (let k in scores) {
    report += `<li><strong>${k}</strong>: ${scores[k]}ì </li>`;
  }
  report += "</ul>";
  document.getElementById("report").innerHTML = report;

  let guide = "<h3>ìƒí™œ ê°€ì´ë“œ</h3><ul>";
  const s = scores;
  if (s["ê¸°ì²´"] === 1) guide += "<li>ê¸° ìˆœí™˜ ì•½ê°„ ì •ì²´. ë³µë¶€ ë§ˆì‚¬ì§€ ì¶”ì²œ</li>";
  if (s["ê¸°ì²´"] >= 2) guide += "<li>ê¸°ì²´ ì‹¬í™”. ê·œì¹™ì  ì‹ì‚¬ì™€ ìš´ë™ í•„ìš”</li>";
  if (s["í˜ˆí—ˆ"] === 1) guide += "<li>ì—ë„ˆì§€ ì†Œëª¨ ì£¼ì˜. íœ´ì‹ ê°•í™”</li>";
  if (s["í˜ˆí—ˆ"] >= 2) guide += "<li>í˜ˆí—ˆ ê²½í–¥. ìˆ™ë©´ + ì² ë¶„ ë³´ì¶© ì‹ë‹¨ í•„ìš”</li>";
  if (s["ìŒí—ˆ"] === 1) guide += "<li>ë¬¼ ìì£¼ ë§ˆì‹œê³ , ì•¼ê°„ í™œë™ ì¤„ì´ê¸°</li>";
  if (s["ìŒí—ˆ"] >= 2) guide += "<li>ìŒí—ˆ ì‹¬í™”. ìˆ˜ë¶„ ì„­ì·¨ + ê³¼ë¡œ ê¸ˆì§€</li>";
  if (s["ì‹ì "] === 1) guide += "<li>ì†Œí™” ë¶ˆí¸ ì•½ê°„ ìˆìŒ. ì‹ì‚¬ëŸ‰ ì¡°ì ˆ í•„ìš”</li>";
  if (s["ì‹ì "] >= 2) guide += "<li>ì‹ì  ì‹¬í™”. ì ˆì‹ ë° ìê·¹ì  ìŒì‹ í”¼í•˜ê¸°</li>";
  if (s["ê°„ê¸°ìš¸ê²°"] === 1) guide += "<li>ê°ì • ì¡°ì ˆ í•„ìš”. ì‚°ì±…, ìŒì•… ì¶”ì²œ</li>";
  if (s["ê°„ê¸°ìš¸ê²°"] >= 2) guide += "<li>ì •ì„œ ë¶ˆì•ˆì •. ëª…ìƒ, ì¼ê¸°, ëŒ€í™” í™œìš©</li>";
  if (Object.values(s).every(v => v === 0)) guide += "<li>ê· í˜• ì¡íŒ ìƒíƒœì…ë‹ˆë‹¤. í˜„ì¬ ìƒí™œìŠµê´€ ìœ ì§€í•˜ì„¸ìš”.</li>";
  guide += "</ul>";
  document.getElementById("guide").innerHTML = guide;

  if (window.myChart) window.myChart.destroy();
  const ctx = document.getElementById("chart").getContext("2d");
  window.myChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: Object.keys(scores),
      datasets: [{
        label: 'ì²´ì§ˆ ì ìˆ˜',
        data: Object.values(scores),
        backgroundColor: 'rgba(75, 192, 192, 0.6)'
      }]
    },
    options: {
      scales: { y: { beginAtZero: true, max: 6 } }
    }
  });
  function getColorForKey(key) {
    const colors = {
      ê¸°ì²´: '#007bff',
      í˜ˆí—ˆ: '#e83e8c',
      ìŒí—ˆ: '#28a745',
      ì‹ì : '#fd7e14',
      ê°„ê¸°ìš¸ê²°: '#6f42c1'
    };
    return colors[key] || '#999';
  }

  const trendCtx = document.getElementById("trendChart").getContext("2d");
  const last7 = history.slice(-7);
  const labels = last7.map(d => d.date);
  const datasets = Object.keys(scores).map(key => ({
    label: key,
    data: last7.map(d => d.scores[key] || 0),
    fill: false,
    borderColor: getColorForKey(key),
    tension: 0.3
  }));

  new Chart(trendCtx, {
    type: 'line',
    data: { labels, datasets },
    options: {
      scales: { y: { beginAtZero: true, max: 6 } },
      plugins: { legend: { position: 'bottom' } }
    }
  });

}
</script>
</body>
</html>